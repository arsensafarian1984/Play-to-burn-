// ۱. اضافه کردن متغیر سرعت به متغیرهای اصلی
let bird, pipes, score, active = false, frame = 0;
let gameSpeed = 3.5; // سرعت اولیه

function reset() {
    bird = { x: 60, y: canvas.height/2, v: 0, g: 0.5 };
    pipes = []; 
    score = 0; 
    frame = 0; 
    gameSpeed = 3.5; // ریست کردن سرعت در هر بار شروع مجدد
    active = true;
    document.getElementById('menu').style.display = 'none';
    loop();
}

function loop() {
    if(!active) return;
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    bird.v += bird.g;
    bird.y += bird.v;
    
    ctx.drawImage(imgTon, bird.x-25, bird.y-25, 50, 50);

    // ۲. مدیریت فاصله موانع بر اساس سرعت (هرچه سرعت بیشتر، فاصله زمانی کمتر)
    let spawnRate = Math.max(50, 100 - (score * 2)); 
    if(frame % Math.floor(spawnRate) === 0) {
        pipes.push({ x: canvas.width, t: Math.random()*(canvas.height-350)+100, scored: false });
    }

    pipes.forEach(p => {
        p.x -= gameSpeed; // ۳. استفاده از متغیر سرعت به جای عدد ثابت
        
        // رسم شعله‌ها (مثل قبل)
        ctx.save();
        ctx.translate(p.x + 30, p.t);
        ctx.scale(1, -1);
        ctx.drawImage(imgFire, -30, 0, 60, p.t);
        ctx.restore();
        ctx.drawImage(imgFire, p.x, p.t + 180, 60, canvas.height - (p.t + 180));

        if(bird.x+20 > p.x && bird.x-20 < p.x+60 && (bird.y-20 < p.t || bird.y+20 > p.t+180)) active = false;
        
        if(p.x < 60 && !p.scored) { 
            p.scored = true; 
            score++; 
            document.getElementById('s').innerText = score;
            
            // ۴. افزایش تدریجی سرعت با هر امتیاز
            gameSpeed += 0.15; 
        }
    });

    pipes = pipes.filter(p => p.x > -100);
    if(bird.y > canvas.height || bird.y < 0) active = false;

    if(!active) {
        document.getElementById('t').innerText = "SCORE: " + score;
        document.getElementById('menu').style.display = 'flex';
        return;
    }

    frame++;
    requestAnimationFrame(loop);
}
