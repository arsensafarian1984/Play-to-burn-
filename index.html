<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Fire Bird</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #111;
  font-family: Arial, sans-serif;
  overflow: hidden;
}

#gameContainer {
  position: relative;
  width: 100vw;
  height: 100vh;
}

canvas {
  display: block;
  background: linear-gradient(#222, #000);
}

/* UI */
#menu, #gameOver {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #fff;
  text-align: center;
}

.hidden {
  display: none;
}

button {
  padding: 14px 26px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  margin: 10px;
}

#startBtn {
  background: #00c853;
  color: #000;
}

#adBtn {
  background: #ffeb3b;
  color: #000;
  display: none;
}

.policy {
  font-size: 12px;
  opacity: 0.75;
  margin-top: 12px;
  max-width: 280px;
}
</style>
</head>

<body>
<div id="gameContainer">
  <canvas id="game"></canvas>

  <!-- START MENU -->
  <div id="menu">
    <h1>üî• Fire Bird</h1>
    <button id="startBtn">START</button>

    <div class="policy">
      This game does not collect or store any personal data.<br>
      Rewarded ads are provided by AdsGram.<br>
      By playing this game, you agree to this policy.
    </div>
  </div>

  <!-- GAME OVER -->
  <div id="gameOver" class="hidden">
    <h2>Game Over</h2>
    <button id="restartBtn">RESTART</button>
    <button id="adBtn">üéÅ WATCH AD</button>
  </div>
</div>

<!-- AdsGram SDK -->
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>

<script>
/* ---------------- CONFIG ---------------- */
const REQUIRED_PLAY_TIME = 60 * 1000; // 1 minute
const AD_COOLDOWN = 4 * 60 * 60 * 1000; // 4 hours
const ADSGRAM_BLOCK_ID = 2340; // TEST BLOCK ID

/* ---------------- CANVAS ---------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* ---------------- GAME STATE ---------------- */
let bird, pipes, lastTime;
let running = false;
let totalPlayTime = 0;
let sessionStart = 0;

let lastAdTime = Number(localStorage.getItem("lastAdTime") || 0);

/* ---------------- OBJECTS ---------------- */
function resetGame() {
  bird = {
    x: canvas.width * 0.3,
    y: canvas.height / 2,
    vy: 0,
    r: 14
  };

  pipes = [];
  spawnPipe();
}

function spawnPipe() {
  const gap = 120; // ÿØŸáÿßŸÜŸá ÿ™ŸÜ⁄Ø‚Äåÿ™ÿ±
  const topHeight = Math.random() * (canvas.height * 0.4) + 50;

  pipes.push({
    x: canvas.width,
    top: topHeight,
    bottom: topHeight + gap,
    w: 60
  });
}

/* ---------------- GAME LOOP ---------------- */
function update(dt) {
  bird.vy += 0.0015 * dt;
  bird.y += bird.vy * dt;

  if (bird.y < 0 || bird.y > canvas.height) endGame();

  for (let p of pipes) {
    p.x -= 0.25 * dt;

    if (collide(p)) endGame();
  }

  if (pipes[0].x + pipes[0].w < 0) {
    pipes.shift();
    spawnPipe();
  }
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Bird
  ctx.fillStyle = "#ff5722";
  ctx.beginPath();
  ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI * 2);
  ctx.fill();

  // Fire Pipes
  for (let p of pipes) {
    drawFirePipe(p.x, 0, p.w, p.top, true);
    drawFirePipe(p.x, p.bottom, p.w, canvas.height - p.bottom, false);
  }
}

function loop(t) {
  if (!running) return;
  if (!lastTime) lastTime = t;
  const dt = t - lastTime;
  lastTime = t;

  update(dt);
  draw();
  requestAnimationFrame(loop);
}

/* ---------------- FIRE PIPE ---------------- */
function drawFirePipe(x, y, w, h, upsideDown) {
  ctx.save();
  ctx.translate(x + w / 2, upsideDown ? h : y);
  if (upsideDown) ctx.scale(1, -1);

  const grad = ctx.createLinearGradient(0, 0, 0, h);
  grad.addColorStop(0, "#ffeb3b");
  grad.addColorStop(0.5, "#ff5722");
  grad.addColorStop(1, "#b71c1c");

  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.moveTo(-w/2, 0);
  ctx.lineTo(w/2, 0);
  ctx.lineTo(w/4, h);
  ctx.lineTo(0, h - 20);
  ctx.lineTo(-w/4, h);
  ctx.closePath();
  ctx.fill();

  ctx.restore();
}

/* ---------------- COLLISION ---------------- */
function collide(p) {
  if (bird.x + bird.r > p.x && bird.x - bird.r < p.x + p.w) {
    if (bird.y - bird.r < p.top || bird.y + bird.r > p.bottom) {
      return true;
    }
  }
  return false;
}

/* ---------------- GAME CONTROL ---------------- */
function startGame() {
  resetGame();
  running = true;
  sessionStart = performance.now();
  lastTime = null;

  document.getElementById("menu").classList.add("hidden");
  document.getElementById("gameOver").classList.add("hidden");

  requestAnimationFrame(loop);
}

function endGame() {
  running = false;
  totalPlayTime += performance.now() - sessionStart;

  const adBtn = document.getElementById("adBtn");
  const canShowAd =
    totalPlayTime >= REQUIRED_PLAY_TIME &&
    Date.now() - lastAdTime >= AD_COOLDOWN;

  adBtn.style.display = canShowAd ? "block" : "none";

  document.getElementById("gameOver").classList.remove("hidden");
}

/* ---------------- INPUT ---------------- */
window.addEventListener("pointerdown", () => {
  if (running) bird.vy = -0.5;
});

/* ---------------- ADSGRAM ---------------- */
const AdController = window.Adsgram
  ? new Adsgram({ blockId: ADSGRAM_BLOCK_ID })
  : null;

document.getElementById("adBtn").onclick = () => {
  if (!AdController) {
    alert("Ads not available");
    return;
  }

  AdController.show()
    .then(() => {
      lastAdTime = Date.now();
      localStorage.setItem("lastAdTime", lastAdTime);
      document.getElementById("adBtn").style.display = "none";
      alert("Thanks for watching!");
    })
    .catch(() => {
      alert("Ad not available now");
    });
};

/* ---------------- UI BUTTONS ---------------- */
document.getElementById("startBtn").onclick = startGame;
document.getElementById("restartBtn").onclick = startGame;
</script>
</body>
</html>
