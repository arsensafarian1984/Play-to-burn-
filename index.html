<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>TON Burner</title>

<style>
body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:Arial;
  touch-action:none;
}
canvas{display:block}

#ui{
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  color:#00eaff;
  font-weight:bold;
  z-index:10;
}

#menu{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.9);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  color:#fff;
  z-index:20;
  text-align:center;
}

.policy{
  font-size:12px;
  opacity:.75;
  max-width:300px;
  margin-top:12px;
  line-height:1.4;
}

button{
  padding:14px 36px;
  border:none;
  border-radius:40px;
  font-size:16px;
  font-weight:bold;
  margin:10px;
  cursor:pointer;
}

#startBtn{background:#00d4ff;color:#000}
#adBtn{background:#ffcc00;color:#000;display:none}
</style>
</head>

<body>

<div id="ui">
SCORE: <span id="score">0</span> | BEST: <span id="best">0</span>
</div>

<div id="menu">
  <h1>TON BURNER</h1>
  <button id="startBtn">START üî•</button>
  <button id="adBtn">BONUS +10 üéÅ</button>

  <div class="policy">
    This game does not collect personal data.<br>
    Rewarded ads are provided by AdsGram.<br>
    Ads are optional and give in-game bonus only.
  </div>
</div>

<canvas id="c"></canvas>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://adsgram.ai/js/adsgram-ad-sdk.js"></script>

<script>
/* ========= ENV ========= */
const isTelegram = !!window.Telegram?.WebApp;
if(isTelegram){
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}

/* ========= CANVAS ========= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

/* ========= ASSETS ========= */
const birdImg = new Image();
birdImg.src = "logo.png";

const fireImg = new Image();
fireImg.src = "fire.png";

/* ========= GAME STATE ========= */
let bird;
let pipes = [];
let score = 0;
let active = false;

let lastTime = 0;
let speed = 220;
const gravity = 900;
const jump = -420;

/* üî• ÿ¥ÿπŸÑŸá‚ÄåŸáÿß - ŸÅÿßÿµŸÑŸá ŸÜÿßŸÖŸÜÿ∏ŸÖ Ÿà ⁄©Ÿàÿ™ÿßŸá/ÿ®ŸÑŸÜÿØ */
const GAP_MIN = 180;
const GAP_MAX = 220;
const PIPE_WIDTH = 60;

/* ========= AD TIME ========= */
let playTime = 0;
let lastFrameTime = performance.now();

/* ========= UI ========= */
const scoreEl = document.getElementById("score");
const bestEl  = document.getElementById("best");
const menu    = document.getElementById("menu");
const adBtn   = document.getElementById("adBtn");

bestEl.textContent = localStorage.getItem("best") || 0;

/* ========= ADS ========= */
let Ad = null;
function initAds(){
  if(!isTelegram) return;
  if(!window.AdsgramAdController) return;
  Ad = window.AdsgramAdController.init({
    blockId:"2340",
    test:true
  });
}

/* ========= GAME ========= */
function startGame(bonus=0){
  bird = { x: canvas.width*0.25, y: canvas.height/2, v:0 };
  pipes = [];
  score = bonus;
  speed = 220;
  active = true;
  scoreEl.textContent = score;
  menu.style.display = "none";
}

function endGame(){
  active = false;
  menu.style.display = "flex";

  const best = +localStorage.getItem("best") || 0;
  if(score > best){
    localStorage.setItem("best", score);
    bestEl.textContent = score;
  }
  updateAdButton();
}

function updateAdButton(){
  adBtn.style.display="none";

  const lastAd = +localStorage.getItem("lastAd") || 0;
  const fourHours = 4*60*60*1000;

  if(Date.now()-lastAd < fourHours) return;
  if(playTime < 60000) return; // ‚úÖ 1 ÿØŸÇ€åŸÇŸá ŸÖÿ¨ŸÖŸàÿπ ÿ®ÿßÿ≤€å
  adBtn.style.display="block";
}

/* ========= LOOP ========= */
function loop(t){
  const dt = (t - lastTime) / 1000;
  lastTime = t;

  /* ‚è± ÿ¨ŸÖÿπ ÿ≤ŸÖÿßŸÜ ŸÅÿπÿßŸÑ ÿ®ŸàÿØŸÜ ÿ®ÿßÿ≤€å */
  if(active){
    playTime += t - lastFrameTime;
  }
  lastFrameTime = t;

  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(active){
    bird.v += gravity * dt;
    bird.y += bird.v * dt;

    if(!pipes.length || pipes[pipes.length-1].x < canvas.width - 300){
      const gap = Math.random()*(GAP_MAX-GAP_MIN)+GAP_MIN;
      const top = Math.random()*(canvas.height-gap-80)+50;
      pipes.push({x:canvas.width, top:top, gap:gap, passed:false});
    }

    pipes.forEach(p=>{
      p.x -= speed*dt;

      if(
        bird.x+20 > p.x &&
        bird.x-20 < p.x+PIPE_WIDTH &&
        (bird.y < p.top || bird.y > p.top + p.gap)
      ){
        endGame();
      }

      if(!p.passed && p.x < bird.x){
        p.passed = true;
        score++;
        speed += 10;
        scoreEl.textContent = score;
      }
    });

    if(pipes[0]?.x < -80) pipes.shift();
    if(bird.y < 0 || bird.y > canvas.height) endGame();
  }

  /* DRAW BIRD */
  if(bird && birdImg.complete){
    ctx.drawImage(birdImg,bird.x-20,bird.y-20,40,40);
  }

  /* DRAW FIRE PIPES */
  pipes.forEach(p=>{
    if(fireImg.complete){
      /* ÿ®ÿßŸÑÿß (ŸÅŸÑŸæ ÿ¥ÿØŸá) */
      ctx.save();
      ctx.translate(p.x+PIPE_WIDTH/2,p.top);
      ctx.scale(1,-1);
      ctx.drawImage(fireImg,-PIPE_WIDTH/2,0,PIPE_WIDTH,p.top);
      ctx.restore();

      /* Ÿæÿß€å€åŸÜ */
      ctx.drawImage(fireImg,p.x,p.top+p.gap,PIPE_WIDTH,canvas.height-(p.top+p.gap));
    }
  });

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ========= INPUT ========= */
addEventListener("mousedown",()=> active && (bird.v=jump));
addEventListener("touchstart",e=>{
  if(active){ bird.v=jump; e.preventDefault(); }
});

/* ========= BUTTONS ========= */
startBtn.onclick=()=>startGame(0);

adBtn.onclick=()=>{
  if(!isTelegram){
    localStorage.setItem("lastAd",Date.now());
    playTime=0;
    startGame(10);
    return;
  }
  initAds();
  Ad?.show().then(()=>{
    localStorage.setItem("lastAd",Date.now());
    playTime=0;
    startGame(10);
  });
};
</script>

</body>
</html>
