<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>TON Burner</title>

<style>
body{
  margin:0;
  background:#000;
  overflow:hidden;
  font-family:Arial;
  touch-action:none;
}
canvas{display:block}

#ui{
  position:absolute;
  top:10px;
  width:100%;
  text-align:center;
  color:#00eaff;
  font-weight:bold;
  z-index:10;
}

#menu{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.9);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  color:#fff;
  z-index:20;
  text-align:center;
}

button{
  padding:14px 36px;
  border:none;
  border-radius:40px;
  font-size:16px;
  font-weight:bold;
  margin:10px;
  cursor:pointer;
}

#startBtn{background:#00d4ff;color:#000}
#adBtn{background:#ffcc00;color:#000}

#toast{
  position:absolute;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.85);
  color:#00eaff;
  padding:12px 22px;
  border-radius:20px;
  font-weight:bold;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:50;
}
#toast.show{opacity:1}
</style>
</head>

<body>

<div id="ui">
SCORE: <span id="score">0</span> | BEST: <span id="best">0</span>
</div>

<div id="menu">
  <h1>TON BURNER</h1>
  <button id="startBtn">START ğŸ”¥</button>
  <button id="adBtn">BONUS +10 ğŸ</button>
</div>

<div id="toast"></div>
<canvas id="c"></canvas>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://adsgram.ai/js/adsgram-ad-sdk.js"></script>

<script>
/* ========= ENV ========= */
const isTelegram = !!window.Telegram?.WebApp;

/* ========= UI ========= */
const scoreEl = document.getElementById("score");
const bestEl  = document.getElementById("best");
const menu    = document.getElementById("menu");
const adBtn   = document.getElementById("adBtn");
const toast   = document.getElementById("toast");

function showMessage(text,time=2500){
  toast.textContent=text;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),time);
}

/* ========= CANVAS ========= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize",resize);
resize();

/* ========= GAME ========= */
let bird, pipes=[], score=0, active=false;
let lastTime=0, speed=220;
const gravity=900, jump=-420;
const GAP_MIN=120, GAP_MAX=200, PIPE_WIDTH=60;

/* ========= BEST ========= */
bestEl.textContent = localStorage.getItem("best")||0;

/* ========= ADS ========= */
let Ad=null, adReady=false;

function initAds(){
  if(!isTelegram || !window.AdsgramAdController){
    console.warn("Ads not available");
    return;
  }
  try{
    Ad = AdsgramAdController.init({
      blockId:"2340",
      test:true
    });
    adReady=true;
    console.log("AdsGram ready");
  }catch(e){
    console.error(e);
    adReady=false;
  }
}

if(isTelegram){
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
  initAds();
}

/* ========= GAME FLOW ========= */
function startGame(bonus=0){
  bird={x:canvas.width*0.25,y:canvas.height/2,v:0};
  pipes=[];
  score=bonus;
  speed=220;
  active=true;
  scoreEl.textContent=score;
  menu.style.display="none";
}

function endGame(){
  active=false;
  menu.style.display="flex";

  const best=+localStorage.getItem("best")||0;
  if(score>best){
    localStorage.setItem("best",score);
    bestEl.textContent=score;
  }
}

/* ========= LOOP ========= */
function loop(t){
  const dt=(t-lastTime)/1000;
  lastTime=t;

  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(active){
    bird.v+=gravity*dt;
    bird.y+=bird.v*dt;

    if(!pipes.length||pipes[pipes.length-1].x<canvas.width-280){
      const gap=Math.random()*(GAP_MAX-GAP_MIN)+GAP_MIN;
      const top=Math.random()*(canvas.height-gap-100)+50;
      pipes.push({x:canvas.width,top,gap,passed:false});
    }

    pipes.forEach(p=>{
      p.x-=speed*dt;

      if(
        bird.x+20>p.x &&
        bird.x-20<p.x+PIPE_WIDTH &&
        (bird.y<p.top||bird.y>p.top+p.gap)
      ) endGame();

      if(!p.passed && p.x<bird.x){
        p.passed=true;
        score++;
        speed+=10;
        scoreEl.textContent=score;
      }
    });

    if(pipes[0]?.x<-80) pipes.shift();
    if(bird.y<0||bird.y>canvas.height) endGame();
  }

  ctx.fillStyle="#0ff";
  if(bird) ctx.fillRect(bird.x-20,bird.y-20,40,40);

  ctx.fillStyle="#f00";
  pipes.forEach(p=>{
    ctx.fillRect(p.x,0,PIPE_WIDTH,p.top);
    ctx.fillRect(p.x,p.top+p.gap,PIPE_WIDTH,canvas.height);
  });

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ========= INPUT ========= */
addEventListener("mousedown",()=>active&&(bird.v=jump));
addEventListener("touchstart",e=>{
  if(active){bird.v=jump;e.preventDefault();}
});

/* ========= BUTTONS ========= */
startBtn.onclick=()=>startGame(0);

adBtn.onclick=()=>{
  if(!isTelegram){
    showMessage("ğŸ§ª ØªØ³Øª: +10 Ø§Ù…ØªÛŒØ§Ø²");
    startGame(10);
    return;
  }
  if(!adReady){
    showMessage("âŒ ØªØ¨Ù„ÛŒØº Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª");
    return;
  }
  Ad.show()
    .then(()=>{
      showMessage("ğŸ‰ +10 Ø§Ù…ØªÛŒØ§Ø² Ú¯Ø±ÙØªÛŒ!");
      startGame(10);
    })
    .catch(()=>{
      showMessage("âš ï¸ ØªØ¨Ù„ÛŒØºÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª");
    });
};
</script>

</body>
</html>
